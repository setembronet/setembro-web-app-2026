{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/utils/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { NextResponse, type NextRequest } from 'next/server'\r\n\r\nexport async function updateSession(request: NextRequest, response?: NextResponse) {\r\n    try {\r\n        let supabaseResponse = response ?? NextResponse.next({\r\n            request,\r\n        })\r\n\r\n        console.log('Middleware Env Check:', {\r\n            url: process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n            hasKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n        });\r\n\r\n        const supabase = createServerClient(\r\n            process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n            {\r\n                cookies: {\r\n                    getAll() {\r\n                        return request.cookies.getAll()\r\n                    },\r\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                    setAll(cookiesToSet: { name: string; value: string; options?: any }[]) {\r\n                        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            request.cookies.set(name, value)\r\n                        )\r\n                        supabaseResponse = NextResponse.next({\r\n                            request,\r\n                        })\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            supabaseResponse.cookies.set(name, value, options)\r\n                        )\r\n                    },\r\n                },\r\n            }\r\n        )\r\n\r\n        const {\r\n            data: { user },\r\n        } = await supabase.auth.getUser()\r\n\r\n        if (request.nextUrl.pathname.startsWith('/admin')) {\r\n            if (!user) {\r\n                console.error(\"Middleware: No User, Redirecting to /login\");\r\n                const url = request.nextUrl.clone()\r\n                url.pathname = '/login'\r\n                const redirectResponse = NextResponse.redirect(url)\r\n                // Copy cookies from supabaseResponse to redirectResponse\r\n                const cookies = supabaseResponse.cookies.getAll()\r\n                cookies.forEach(cookie => redirectResponse.cookies.set(cookie.name, cookie.value, cookie))\r\n                return redirectResponse\r\n            }\r\n\r\n            // Check for Admin Role using user_metadata\r\n            const role = user.user_metadata?.role;\r\n\r\n            console.log(\"Middleware Admin Check:\", { userId: user.id, role });\r\n\r\n            // If no role or not admin, redirect to home\r\n            if (role !== 'admin') {\r\n                console.error(\"Middleware: Not Admin (Metadata check), Redirecting to /\");\r\n                const url = request.nextUrl.clone()\r\n                url.pathname = '/'\r\n                const redirectResponse = NextResponse.redirect(url)\r\n                // Copy cookies from supabaseResponse to redirectResponse\r\n                const cookies = supabaseResponse.cookies.getAll()\r\n                cookies.forEach(cookie => redirectResponse.cookies.set(cookie.name, cookie.value, cookie))\r\n                return redirectResponse\r\n            }\r\n        }\r\n\r\n        return supabaseResponse\r\n    } catch (error) {\r\n        console.error(\"Middleware Error caught:\", error);\r\n        return response ?? NextResponse.next({ request });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,cAAc,OAAoB,EAAE,QAAuB;IAC7E,IAAI;QACA,IAAI,mBAAmB,YAAY,gMAAY,CAAC,IAAI,CAAC;YACjD;QACJ;QAEA,QAAQ,GAAG,CAAC,yBAAyB;YACjC,GAAG;YACH,QAAQ,CAAC;QACb;QAEA,MAAM,WAAW,IAAA,uMAAkB,oKAG/B;YACI,SAAS;gBACL;oBACI,OAAO,QAAQ,OAAO,CAAC,MAAM;gBACjC;gBACA,8DAA8D;gBAC9D,QAAO,YAA8D;oBACjE,6DAA6D;oBAC7D,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;oBAE9B,mBAAmB,gMAAY,CAAC,IAAI,CAAC;wBACjC;oBACJ;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;gBAElD;YACJ;QACJ;QAGJ,MAAM,EACF,MAAM,EAAE,IAAI,EAAE,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW;YAC/C,IAAI,CAAC,MAAM;gBACP,QAAQ,KAAK,CAAC;gBACd,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,QAAQ,GAAG;gBACf,MAAM,mBAAmB,gMAAY,CAAC,QAAQ,CAAC;gBAC/C,yDAAyD;gBACzD,MAAM,UAAU,iBAAiB,OAAO,CAAC,MAAM;gBAC/C,QAAQ,OAAO,CAAC,CAAA,SAAU,iBAAiB,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE;gBAClF,OAAO;YACX;YAEA,2CAA2C;YAC3C,MAAM,OAAO,KAAK,aAAa,EAAE;YAEjC,QAAQ,GAAG,CAAC,2BAA2B;gBAAE,QAAQ,KAAK,EAAE;gBAAE;YAAK;YAE/D,4CAA4C;YAC5C,IAAI,SAAS,SAAS;gBAClB,QAAQ,KAAK,CAAC;gBACd,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,QAAQ,GAAG;gBACf,MAAM,mBAAmB,gMAAY,CAAC,QAAQ,CAAC;gBAC/C,yDAAyD;gBACzD,MAAM,UAAU,iBAAiB,OAAO,CAAC,MAAM;gBAC/C,QAAQ,OAAO,CAAC,CAAA,SAAU,iBAAiB,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE;gBAClF,OAAO;YACX;QACJ;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,YAAY,gMAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACnD;AACJ"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { type NextRequest } from 'next/server'\r\nimport { updateSession } from '@/utils/supabase/middleware'\r\nexport default async function middleware(request: NextRequest) {\r\n    return await updateSession(request);\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        /*\r\n         * Match all request paths except for the ones starting with:\r\n         * - _next/static (static files)\r\n         * - _next/image (image optimization files)\r\n         * - favicon.ico (favicon file)\r\n         * - images - .svg, .png, .jpg, .jpeg, .gif, .webp\r\n         * Feel free to modify this pattern to include more paths.\r\n         */\r\n        '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\r\n    ],\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AACe,eAAe,WAAW,OAAoB;IACzD,OAAO,MAAM,IAAA,+JAAa,EAAC;AAC/B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;;SAOC,GACD;KACH;AACL"}}]
}