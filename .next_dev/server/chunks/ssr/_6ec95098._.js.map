{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/actions/search-posts.ts","../../../../src/lib/ai/gemini.ts","../../../../.next-internal/server/app/hosting/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { generateEmbedding } from '@/lib/ai/gemini';\r\n\r\nexport type SearchResult = {\r\n    id: string;\r\n    title: string;\r\n    slug: string;\r\n    excerpt: string;\r\n    featured_image: string;\r\n    published_at: string;\r\n    category_id: string;\r\n    semantic_similarity: number;\r\n    keyword_score: number;\r\n};\r\n\r\nexport async function searchPosts(query: string, limit: number = 5): Promise<SearchResult[]> {\r\n    if (!query || query.trim().length === 0) return [];\r\n\r\n    const supabase = await createClient();\r\n\r\n    // 1. Generate an embedding for the user's search query using Gemini (Julia)\r\n    const queryEmbedding = await generateEmbedding(query);\r\n\r\n    // Fallback: If AI fails or doesn't return vector, use zero-vector to run keyword-only search\r\n    const vectorStr = queryEmbedding\r\n        ? `[${queryEmbedding.join(',')}]`\r\n        : `[${new Array(768).fill(0).join(',')}]`;\r\n\r\n    // 2. Call the hybrid search RPC function we created in Supabase\r\n    const { data, error } = await supabase.rpc('search_posts_hybrid', {\r\n        query_embedding: vectorStr,\r\n        query_text: query,\r\n        match_count: limit\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Hybrid Search Error:\", error.message);\r\n        return [];\r\n    }\r\n\r\n    return (data as SearchResult[]) || [];\r\n}\r\n","// src/lib/ai/gemini.ts\r\n\r\nexport async function generateEmbedding(text: string): Promise<number[] | null> {\r\n    if (!text || text.trim() === '') return null;\r\n\r\n    // Note: In Next.js Server Actions, process.env is securely available.\r\n    const apiKey = process.env.GEMINI_API_KEY;\r\n    if (!apiKey) {\r\n        console.warn(\"GEMINI_API_KEY is not set. Embedding generation will fail.\");\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(\r\n            `https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent?key=${apiKey}`,\r\n            {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    model: \"models/text-embedding-004\",\r\n                    content: { parts: [{ text }] }\r\n                })\r\n            }\r\n        );\r\n\r\n        if (!response.ok) {\r\n            console.error(\"Gemini API falhou com status:\", response.status);\r\n            return null;\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.embedding && data.embedding.values) {\r\n            return data.embedding.values;\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error(\"Failed to generate embedding with Gemini:\", error);\r\n        return null;\r\n    }\r\n}\r\n","export {searchPosts as '60f070d1500ba58e880e29ff549cefa08c8f7f5a8f'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"6CAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,iCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAI,AAAkB,YAAY,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,gBAAA,CAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,oDCDhB,EAAA,EAAA,CAAA,CAAA,OCAO,eAAe,EAAkB,CAAY,EAChD,GAAI,CAAC,GAAwB,KAAhB,EAAK,IAAI,GAAW,OAAO,KAGxC,IAAM,EAAS,QAAQ,GAAG,CAAC,cAAc,CACzC,GAAI,CAAC,EAED,MAFS,CACT,QAAQ,IAAI,CAAC,8DACN,KAGX,GAAI,CACA,IAAM,EAAW,MAAM,MACnB,CAAC,4FAA4F,EAAE,EAAA,CAAQ,CACvG,CACI,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,CACjB,MAAO,4BACP,QAAS,CAAE,MAAO,CAAC,MAAE,CAAK,EAAE,AAAC,CACjC,EACJ,GAGJ,GAAI,CAAC,EAAS,EAAE,CAEZ,CAFc,MACd,QAAQ,KAAK,CAAC,gCAAiC,EAAS,MAAM,EACvD,KAGX,IAAM,EAAO,MAAM,EAAS,IAAI,GAEhC,GAAI,EAAK,SAAS,EAAI,EAAK,SAAS,CAAC,MAAM,CACvC,CADyC,MAClC,EAAK,SAAS,CAAC,MAAM,CAGhC,OAAO,IACX,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,4CAA6C,GACpD,IACX,CACJ,CDxBO,eAAe,EAAY,CAAa,CAAE,EAAgB,CAAC,EAC9D,GAAI,CAAC,GAAiC,IAAxB,EAAM,IAAI,GAAG,MAAM,CAAQ,MAAO,EAAE,CAElD,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAG7B,EAAiB,MAAM,EAAkB,GAGzC,EAAY,EACZ,CAAC,CAAC,EAAE,EAAe,IAAI,CAAC,KAAK,CAAC,CAAC,CAC/B,CAAC,CAAC,EAAE,AAAI,MAAM,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAGvC,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAS,GAAG,CAAC,sBAAuB,CAC9D,gBAAiB,EACjB,WAAY,EACZ,YAAa,CACjB,UAEA,AAAI,GACA,IADO,IACC,KAAK,CAAC,uBAAwB,EAAM,OAAO,EAC5C,EAAE,EAGL,GAA2B,EAAE,AACzC,iFA1BsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,+DEjBtB,IAAA,EAAA,EAAA,CAAA,CAAA","ignoreList":[0,1]}